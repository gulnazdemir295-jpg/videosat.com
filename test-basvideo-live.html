<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>basvideo.com Canlı Yayın Testi</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-container {
            background: #2a2a2a;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #dc2626;
            margin: 20px 0;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
        }
        .success { background: #28a745; color: white; }
        .error { background: #dc2626; color: white; }
        .warning { background: #ffc107; color: black; }
        .info { background: #17a2b8; color: white; }
        .test-btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            font-weight: bold;
        }
        .test-btn:hover {
            background: #b91c1c;
            transform: scale(1.05);
        }
        .test-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        video {
            width: 100%;
            max-width: 600px;
            background: #000;
            border: 3px solid #dc2626;
            border-radius: 15px;
            margin: 20px 0;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            border: 1px solid #333;
        }
        .domain-info {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #333;
            margin: 20px 0;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #333;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #555;
        }
        .feature-card h3 {
            color: #dc2626;
            margin-bottom: 15px;
        }
        .checklist {
            list-style: none;
            padding: 0;
        }
        .checklist li {
            padding: 8px 0;
            border-bottom: 1px solid #444;
        }
        .checklist li:before {
            content: "✓ ";
            color: #28a745;
            font-weight: bold;
            margin-right: 10px;
        }
        .url-info {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #dc2626;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1><i class="fas fa-globe"></i> basvideo.com Canlı Yayın Testi</h1>
    
    <div class="domain-info">
        <h2><i class="fas fa-info-circle"></i> Domain Bilgileri</h2>
        <div class="url-info">
            <strong>Test URL:</strong> <span id="currentUrl">Yükleniyor...</span><br>
            <strong>Protocol:</strong> <span id="protocol">Yükleniyor...</span><br>
            <strong>Hostname:</strong> <span id="hostname">Yükleniyor...</span><br>
            <strong>HTTPS Durumu:</strong> <span id="httpsStatus">Yükleniyor...</span>
        </div>
    </div>

    <div class="test-container">
        <h2><i class="fas fa-camera"></i> Kamera Erişimi Testi</h2>
        <div id="cameraStatus" class="status info">Kamera erişimi test ediliyor...</div>
        <button class="test-btn" onclick="testCameraAccess()">
            <i class="fas fa-video"></i> Kamera Erişimi Test Et
        </button>
        <video id="testVideo" autoplay muted playsinline style="display: none;"></video>
    </div>

    <div class="test-container">
        <h2><i class="fas fa-broadcast-tower"></i> Canlı Yayın Testi</h2>
        <div id="streamStatus" class="status info">Canlı yayın test ediliyor...</div>
        <button class="test-btn" onclick="testLiveStream()">
            <i class="fas fa-play"></i> Canlı Yayın Test Et
        </button>
        <button class="test-btn" onclick="stopTest()" id="stopBtn" disabled>
            <i class="fas fa-stop"></i> Testi Durdur
        </button>
    </div>

    <div class="test-container">
        <h2><i class="fas fa-cogs"></i> Sistem Kontrolü</h2>
        <div id="systemStatus" class="status info">Sistem kontrol ediliyor...</div>
        <button class="test-btn" onclick="checkSystem()">
            <i class="fas fa-check-circle"></i> Sistem Kontrol Et
        </button>
    </div>

    <div class="feature-grid">
        <div class="feature-card">
            <h3><i class="fas fa-shield-alt"></i> Güvenlik Özellikleri</h3>
            <ul class="checklist">
                <li>HTTPS zorunlu (CloudFront)</li>
                <li>SSL sertifikası (AWS Certificate Manager)</li>
                <li>Güvenli WebRTC bağlantısı</li>
                <li>CORS politikaları</li>
            </ul>
        </div>
        
        <div class="feature-card">
            <h3><i class="fas fa-rocket"></i> Performans Özellikleri</h3>
            <ul class="checklist">
                <li>CloudFront CDN</li>
                <li>Global edge locations</li>
                <li>Otomatik sıkıştırma</li>
                <li>Hızlı yükleme</li>
            </ul>
        </div>
        
        <div class="feature-card">
            <h3><i class="fas fa-mobile-alt"></i> Uyumluluk</h3>
            <ul class="checklist">
                <li>Chrome (Önerilen)</li>
                <li>Firefox</li>
                <li>Safari</li>
                <li>Edge</li>
                <li>Mobil tarayıcılar</li>
            </ul>
        </div>
    </div>

    <div class="test-container">
        <h2><i class="fas fa-bug"></i> Hata Logları</h2>
        <div id="errorLog" class="log">Hata logları burada görünecek...</div>
        <button class="test-btn" onclick="clearLog()">
            <i class="fas fa-trash"></i> Logları Temizle
        </button>
    </div>

    <div class="test-container">
        <h2><i class="fas fa-external-link-alt"></i> Canlı Test Linkleri</h2>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <a href="https://basvideo.com/live-stream.html" target="_blank" class="test-btn" style="text-decoration: none;">
                <i class="fas fa-video"></i> Canlı Yayın Sayfası
            </a>
            <a href="https://basvideo.com/debug-live-stream.html" target="_blank" class="test-btn" style="text-decoration: none;">
                <i class="fas fa-bug"></i> Debug Sayfası
            </a>
            <a href="https://basvideo.com/test-login.html" target="_blank" class="test-btn" style="text-decoration: none;">
                <i class="fas fa-sign-in-alt"></i> Giriş Testi
            </a>
        </div>
    </div>

    <div style="margin-top: 30px; text-align: center;">
        <a href="live-stream.html" style="color: #dc2626; font-size: 18px;">
            <i class="fas fa-arrow-left"></i> Ana Canlı Yayın Sayfasına Dön
        </a>
    </div>

    <script>
        let testStream = null;
        let logContainer = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            logContainer = document.getElementById('errorLog');
            updateDomainInfo();
            checkSystem();
        });
        
        // Update domain info
        function updateDomainInfo() {
            document.getElementById('currentUrl').textContent = window.location.href;
            document.getElementById('protocol').textContent = window.location.protocol;
            document.getElementById('hostname').textContent = window.location.hostname;
            
            const isHttps = window.location.protocol === 'https:';
            const httpsStatus = document.getElementById('httpsStatus');
            if (isHttps) {
                httpsStatus.textContent = '✅ HTTPS Aktif';
                httpsStatus.style.color = '#28a745';
            } else {
                httpsStatus.textContent = '❌ HTTP (HTTPS gerekli)';
                httpsStatus.style.color = '#dc2626';
            }
        }
        
        // Log function
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logContainer.textContent += logEntry;
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // Clear log
        function clearLog() {
            logContainer.textContent = '';
        }
        
        // Check system
        function checkSystem() {
            const status = document.getElementById('systemStatus');
            let issues = [];
            let solutions = [];
            
            // Check HTTPS
            if (window.location.protocol !== 'https:') {
                issues.push('HTTPS gereklidir');
                solutions.push('basvideo.com otomatik olarak HTTPS kullanır');
            }
            
            // Check WebRTC support
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                issues.push('WebRTC desteklenmiyor');
                solutions.push('Modern tarayıcı kullanın (Chrome, Firefox, Safari, Edge)');
            }
            
            // Check localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                addLog('localStorage çalışıyor', 'success');
            } catch (e) {
                issues.push('localStorage çalışmıyor');
                solutions.push('Tarayıcı ayarlarını kontrol edin');
                addLog('localStorage hatası: ' + e.message, 'error');
            }
            
            // Check domain
            if (window.location.hostname === 'basvideo.com') {
                addLog('basvideo.com domain tespit edildi', 'success');
            } else {
                addLog('Farklı domain: ' + window.location.hostname, 'warning');
            }
            
            // Update status
            if (issues.length === 0) {
                status.innerHTML = '<i class="fas fa-check-circle"></i> Sistem basvideo.com için uyumlu';
                status.className = 'status success';
                addLog('Sistem kontrolü başarılı - basvideo.com uyumlu', 'success');
            } else {
                status.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ' + issues.join(', ');
                status.className = 'status error';
                addLog('Sistem sorunları: ' + issues.join(', '), 'error');
            }
        }
        
        // Test camera access
        async function testCameraAccess() {
            const status = document.getElementById('cameraStatus');
            const video = document.getElementById('testVideo');
            
            try {
                addLog('basvideo.com kamera erişimi test ediliyor...', 'info');
                status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Kamera erişimi isteniyor...';
                status.className = 'status info';
                
                testStream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    },
                    audio: true
                });
                
                video.srcObject = testStream;
                video.style.display = 'block';
                
                status.innerHTML = '<i class="fas fa-check-circle"></i> basvideo.com kamera erişimi başarılı';
                status.className = 'status success';
                addLog('basvideo.com kamera erişimi başarılı', 'success');
                
            } catch (error) {
                status.innerHTML = '<i class="fas fa-times-circle"></i> Kamera erişimi başarısız: ' + error.message;
                status.className = 'status error';
                addLog('basvideo.com kamera hatası: ' + error.message, 'error');
                
                // Specific error solutions
                if (error.name === 'NotAllowedError') {
                    addLog('Çözüm: Tarayıcı ayarlarından kamera izni verin', 'warning');
                } else if (error.name === 'NotFoundError') {
                    addLog('Çözüm: Kamera cihazı bulunamadı', 'warning');
                } else if (error.name === 'NotReadableError') {
                    addLog('Çözüm: Kamera başka uygulama tarafından kullanılıyor', 'warning');
                }
            }
        }
        
        // Test live stream
        async function testLiveStream() {
            const status = document.getElementById('streamStatus');
            const stopBtn = document.getElementById('stopBtn');
            
            try {
                addLog('basvideo.com canlı yayın testi başlatılıyor...', 'info');
                status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Canlı yayın testi...';
                status.className = 'status info';
                
                // Test camera access first
                if (!testStream) {
                    await testCameraAccess();
                    if (!testStream) {
                        throw new Error('Kamera erişimi gerekli');
                    }
                }
                
                // Simulate stream start
                status.innerHTML = '<i class="fas fa-check-circle"></i> basvideo.com canlı yayın testi başarılı';
                status.className = 'status success';
                addLog('basvideo.com canlı yayın testi başarılı', 'success');
                
                stopBtn.disabled = false;
                
            } catch (error) {
                status.innerHTML = '<i class="fas fa-times-circle"></i> Canlı yayın testi başarısız: ' + error.message;
                status.className = 'status error';
                addLog('basvideo.com canlı yayın test hatası: ' + error.message, 'error');
            }
        }
        
        // Stop test
        function stopTest() {
            if (testStream) {
                testStream.getTracks().forEach(track => track.stop());
                testStream = null;
            }
            
            document.getElementById('testVideo').srcObject = null;
            document.getElementById('testVideo').style.display = 'none';
            
            const status = document.getElementById('streamStatus');
            status.innerHTML = '<i class="fas fa-stop-circle"></i> Test durduruldu';
            status.className = 'status info';
            
            document.getElementById('stopBtn').disabled = true;
            addLog('basvideo.com test durduruldu', 'info');
        }
        
        // Error handling
        window.addEventListener('error', function(e) {
            addLog('JavaScript hatası: ' + e.message + ' (' + e.filename + ':' + e.lineno + ')', 'error');
        });
        
        // Unhandled promise rejections
        window.addEventListener('unhandledrejection', function(e) {
            addLog('Promise hatası: ' + e.reason, 'error');
        });
    </script>
</body>
</html>
