<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Canlƒ± Yayƒ±n ƒ∞zle - Ger√ßek Zamanlƒ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .video-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: white;
            font-size: 18px;
            text-align: center;
        }

        .video-info {
            margin-bottom: 20px;
        }

        .video-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .video-meta {
            display: flex;
            gap: 20px;
            color: #666;
            font-size: 0.9em;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #4ecdc4;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .category-btn {
            padding: 8px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .category-btn:hover {
            border-color: #4ecdc4;
            background: #f0fdfc;
        }

        .category-btn.active {
            border-color: #4ecdc4;
            background: #4ecdc4;
            color: white;
        }

        .broadcast-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .broadcast-item {
            padding: 15px;
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .broadcast-item:hover {
            border-color: #4ecdc4;
            background: #f0fdfc;
        }

        .broadcast-item.active {
            border-color: #4ecdc4;
            background: #4ecdc4;
            color: white;
        }

        .broadcast-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .broadcast-meta {
            font-size: 0.8em;
            opacity: 0.8;
            display: flex;
            justify-content: space-between;
        }

        .viewer-count {
            color: #ff6b6b;
            font-weight: 600;
        }

        .chat-container {
            height: 300px;
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .chat-message {
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .chat-message .sender {
            font-weight: 600;
            color: #4ecdc4;
        }

        .chat-message .time {
            font-size: 0.8em;
            color: #666;
            float: right;
        }

        .chat-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #e1e5e9;
            border-radius: 20px;
            outline: none;
        }

        .chat-input button {
            padding: 10px 20px;
            background: #4ecdc4;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .chat-input button:hover {
            background: #3bb5b0;
        }

        .back-link {
            display: inline-block;
            color: white;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            transition: background 0.3s ease;
        }

        .back-link:hover {
            background: rgba(255,255,255,0.3);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-indicator.live {
            background: #ff6b6b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Ana Sayfaya D√∂n</a>
        
        <div class="header">
            <h1>üëÄ Modern Canlƒ± Yayƒ±n ƒ∞zle</h1>
            <p>Kategorize edilmi≈ü canlƒ± yayƒ±nlarƒ± ke≈üfedin ve izleyin</p>
        </div>

        <div class="main-content">
            <div class="video-section">
            <div class="video-container" id="videoContainer">
                <div class="video-placeholder">
                    <div>
                        <div style="font-size: 4em; margin-bottom: 20px; animation: pulse 2s infinite;">üì∫</div>
                        <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px;">Canlƒ± Yayƒ±n ƒ∞zleyici</div>
                        <div style="font-size: 0.9em; opacity: 0.8;">Bir yayƒ±n se√ßin veya kategorilere g√∂z atƒ±n</div>
                        <div style="margin-top: 20px; padding: 10px; background: rgba(78, 205, 196, 0.1); border-radius: 10px; font-size: 0.8em;">
                            üí° ƒ∞pucu: Kategorilerden birini se√ßerek aktif yayƒ±nlarƒ± filtreleyebilirsiniz
                        </div>
                    </div>
                </div>
            </div>

                <div class="video-info" id="videoInfo" style="display: none;">
                    <div class="video-title" id="videoTitle"></div>
                    <div class="video-meta">
                        <div class="meta-item">
                            <span class="status-indicator live"></span>
                            <span>Canlƒ±</span>
                        </div>
                        <div class="meta-item">
                            <span>üë•</span>
                            <span id="viewerCount">0 izleyici</span>
                        </div>
                        <div class="meta-item">
                            <span>üìÖ</span>
                            <span id="startTime"></span>
                        </div>
                        <div class="meta-item">
                            <span>üè∑Ô∏è</span>
                            <span id="categoryName"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="card">
                    <h3>üè∑Ô∏è Kategoriler</h3>
                    <div class="category-filter" id="categoryFilter">
                        <div class="category-btn active" data-category="all">T√ºm√º</div>
                        <div class="category-btn" data-category="teknoloji">üíª Teknoloji</div>
                        <div class="category-btn" data-category="moda">üëó Moda</div>
                        <div class="category-btn" data-category="ev-yasam">üè† Ev & Ya≈üam</div>
                        <div class="category-btn" data-category="spor">‚öΩ Spor</div>
                        <div class="category-btn" data-category="sanat">üé® Sanat</div>
                        <div class="category-btn" data-category="yemek">üç≥ Yemek</div>
                        <div class="category-btn" data-category="egitim">üìö Eƒüitim</div>
                        <div class="category-btn" data-category="saglik">üíä Saƒülƒ±k</div>
                        <div class="category-btn" data-category="otomotiv">üöó Otomotiv</div>
                        <div class="category-btn" data-category="oyuncak">üß∏ Oyuncak</div>
                        <div class="category-btn" data-category="diger">üì¶ Diƒüer</div>
                    </div>
                </div>

                <div class="card">
                    <h3>üì∫ Aktif Yayƒ±nlar</h3>
                    <div class="broadcast-list" id="broadcastList">
                        <div style="text-align: center; color: #666; padding: 20px;">
                            Yayƒ±nlar y√ºkleniyor...
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üí¨ Canlƒ± Sohbet</h3>
                    <div class="chat-container" id="chatContainer">
                        <div style="text-align: center; color: #666; padding: 20px;">
                            Bir yayƒ±n se√ßin ve sohbete katƒ±lƒ±n
                        </div>
                    </div>
                    <div class="chat-input" id="chatInput" style="display: none;">
                        <input type="text" id="chatMessage" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n...">
                        <button onclick="sendMessage()">G√∂nder</button>
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <a href="canli-yayin-gercek.html" class="btn" style="background: #667eea; text-decoration: none; display: inline-block; text-align: center; padding: 12px 20px; font-size: 0.9em;">üé• Ger√ßek Yayƒ±n</a>
                        <a href="canli-yayin-yap-modern.html" class="btn" style="background: #45b7d1; text-decoration: none; display: inline-block; text-align: center; padding: 12px 20px; font-size: 0.9em;">üé¨ Yayƒ±n Ba≈ülat</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="http://localhost:3001/socket.io/socket.io.js"></script>
    <script>
        const socket = io('http://localhost:3001', {
            transports: ['websocket', 'polling'],
            timeout: 20000,
            forceNew: true
        });
        let currentBroadcastId = null;
        let currentCategory = 'all';
        let broadcasts = [];

        // DOM elements
        const videoContainer = document.getElementById('videoContainer');
        const videoInfo = document.getElementById('videoInfo');
        const videoTitle = document.getElementById('videoTitle');
        const viewerCount = document.getElementById('viewerCount');
        const startTime = document.getElementById('startTime');
        const categoryName = document.getElementById('categoryName');
        const broadcastList = document.getElementById('broadcastList');
        const chatContainer = document.getElementById('chatContainer');
        const chatInput = document.getElementById('chatInput');
        const categoryFilter = document.getElementById('categoryFilter');

        // Socket events
        socket.on('connect', () => {
            console.log('Connected to server:', socket.id);
            loadBroadcasts();
        });

        socket.on('disconnect', () => {
            console.log('Disconnected from server');
        });

        socket.on('activeBroadcasts', (data) => {
            broadcasts = data;
            updateBroadcastList();
        });

        socket.on('newBroadcast', (broadcast) => {
            broadcasts.push(broadcast);
            updateBroadcastList();
        });

        socket.on('broadcastEnded', (data) => {
            broadcasts = broadcasts.filter(b => b.id !== data.broadcastId);
            updateBroadcastList();
            
            if (currentBroadcastId === data.broadcastId) {
                leaveCurrentBroadcast();
            }
        });

        socket.on('joinedBroadcast', (broadcast) => {
            console.log('Joined broadcast:', broadcast);
            currentBroadcastId = broadcast.id;
            updateVideoInfo(broadcast);
            chatInput.style.display = 'flex';
            chatContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Sohbete katƒ±ldƒ±nƒ±z!</div>';
        });

        socket.on('viewerJoined', (data) => {
            if (data.broadcastId === currentBroadcastId) {
                viewerCount.textContent = `${data.viewers} izleyici`;
            }
        });

        socket.on('viewerLeft', (data) => {
            if (data.broadcastId === currentBroadcastId) {
                viewerCount.textContent = `${data.viewers} izleyici`;
            }
        });

        socket.on('broadcastMessage', (data) => {
            if (data.broadcastId === currentBroadcastId) {
                addChatMessage(data.sender, data.message, data.timestamp);
            }
        });

        // Listen for broadcast updates
        socket.on('broadcastUpdated', (broadcast) => {
            if (broadcast.id === currentBroadcastId) {
                console.log('Broadcast updated:', broadcast);
                updateVideoInfo(broadcast);
            }
        });

        // Handle broadcast not found
        socket.on('broadcastNotFound', (data) => {
            console.error('Broadcast not found:', data.broadcastId);
            alert('Yayƒ±n bulunamadƒ±! Yayƒ±ncƒ± yayƒ±nƒ± durdurmu≈ü olabilir.');
        });

        // Category filter
        categoryFilter.addEventListener('click', (e) => {
            if (e.target.classList.contains('category-btn')) {
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                e.target.classList.add('active');
                currentCategory = e.target.dataset.category;
                console.log('Category changed to:', currentCategory);
                updateBroadcastList();
            }
        });

        // Load broadcasts
        function loadBroadcasts() {
            socket.emit('getActiveBroadcasts');
        }

        // Update broadcast list
        function updateBroadcastList() {
            console.log('Updating broadcast list. Current category:', currentCategory, 'Total broadcasts:', broadcasts.length);
            
            let filteredBroadcasts = broadcasts;
            
            if (currentCategory !== 'all') {
                filteredBroadcasts = broadcasts.filter(b => b.category === currentCategory);
                console.log('Filtered broadcasts for category', currentCategory, ':', filteredBroadcasts.length);
            }

            if (filteredBroadcasts.length === 0) {
                broadcastList.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 20px;">
                        ${currentCategory === 'all' ? 'Hen√ºz aktif yayƒ±n yok' : `Bu kategoride (${currentCategory}) aktif yayƒ±n yok`}
                    </div>
                `;
                return;
            }

            broadcastList.innerHTML = '';
            filteredBroadcasts.forEach(broadcast => {
                const item = document.createElement('div');
                item.className = 'broadcast-item';
                if (broadcast.id === currentBroadcastId) {
                    item.classList.add('active');
                }
                
                item.innerHTML = `
                    <div class="broadcast-title">${broadcast.title}</div>
                    <div class="broadcast-meta">
                        <span>${broadcast.categoryName}</span>
                        <span class="viewer-count">üë• ${broadcast.viewers}</span>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    console.log('Joining broadcast:', broadcast.id);
                    joinBroadcast(broadcast);
                });
                
                broadcastList.appendChild(item);
            });
        }

        // Join broadcast
        function joinBroadcast(broadcast) {
            console.log('Attempting to join broadcast:', broadcast.id, broadcast);
            
            if (currentBroadcastId) {
                socket.emit('leaveBroadcast', { broadcastId: currentBroadcastId });
            }
            
            socket.emit('joinBroadcast', { broadcastId: broadcast.id });
            
            // Update UI immediately
            document.querySelectorAll('.broadcast-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the clicked item
            const items = document.querySelectorAll('.broadcast-item');
            items.forEach(item => {
                if (item.textContent.includes(broadcast.title)) {
                    item.classList.add('active');
                }
            });
            
            // Force update video info immediately
            setTimeout(() => {
                updateVideoInfo(broadcast);
            }, 100);
        }

        // Leave current broadcast
        function leaveCurrentBroadcast() {
            if (currentBroadcastId) {
                socket.emit('leaveBroadcast', { broadcastId: currentBroadcastId });
            }
            
            currentBroadcastId = null;
            videoInfo.style.display = 'none';
            chatInput.style.display = 'none';
            videoContainer.innerHTML = `
                <div class="video-placeholder">
                    <div>
                        <div style="font-size: 3em; margin-bottom: 10px;">üì∫</div>
                        <div>Bir yayƒ±n se√ßin veya kategorilere g√∂z atƒ±n</div>
                    </div>
                </div>
            `;
            chatContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Bir yayƒ±n se√ßin ve sohbete katƒ±lƒ±n</div>';
        }

        // Update video info
        function updateVideoInfo(broadcast) {
            console.log('Updating video info for broadcast:', broadcast);
            
            if (!broadcast) {
                console.error('No broadcast data provided');
                return;
            }
            
            videoInfo.style.display = 'block';
            videoTitle.textContent = broadcast.title;
            viewerCount.textContent = `${broadcast.viewers} izleyici`;
            categoryName.textContent = broadcast.categoryName;
            startTime.textContent = new Date(broadcast.startTime).toLocaleTimeString('tr-TR');
            
            // Create realistic video stream simulation
            videoContainer.innerHTML = `
                <div style="position: relative; width: 100%; height: 100%; background: linear-gradient(45deg, #1a1a1a, #2d2d2d); border-radius: 10px; overflow: hidden;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white;">
                        <div style="font-size: 4em; margin-bottom: 20px; animation: pulse 2s infinite;">üìπ</div>
                        <div style="font-size: 1.5em; font-weight: bold; margin-bottom: 10px;">${broadcast.title}</div>
                        <div style="font-size: 1em; opacity: 0.8; margin-bottom: 15px;">${broadcast.categoryName}</div>
                        <div style="display: flex; justify-content: center; gap: 20px; font-size: 0.9em; opacity: 0.7;">
                            <span>üë• ${broadcast.viewers} izleyici</span>
                            <span>üî¥ CANLI</span>
                        </div>
                    </div>
                    <div style="position: absolute; top: 10px; right: 10px; background: rgba(255,0,0,0.8); color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8em; font-weight: bold;">
                        CANLI
                    </div>
                    <div style="position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8em;">
                        ${broadcast.slogan || 'Canlƒ± Yayƒ±n'}
                    </div>
                </div>
            `;
            
            // Add some visual effects
            addVideoEffects();
            
            console.log('Video info updated successfully');
        }
        
        // Add visual effects to simulate live streaming
        function addVideoEffects() {
            const container = videoContainer.querySelector('div');
            if (container) {
                // Add subtle animation
                container.style.animation = 'videoGlow 3s ease-in-out infinite alternate';
                
                // Add CSS for animation
                if (!document.getElementById('videoEffects')) {
                    const style = document.createElement('style');
                    style.id = 'videoEffects';
                    style.textContent = `
                        @keyframes videoGlow {
                            0% { box-shadow: 0 0 20px rgba(78, 205, 196, 0.3); }
                            100% { box-shadow: 0 0 30px rgba(78, 205, 196, 0.6); }
                        }
                        @keyframes pulse {
                            0% { transform: scale(1); }
                            50% { transform: scale(1.1); }
                            100% { transform: scale(1); }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
        }

        // Send message
        function sendMessage() {
            const messageInput = document.getElementById('chatMessage');
            const message = messageInput.value.trim();
            
            if (message && currentBroadcastId) {
                console.log('Sending message:', message, 'to broadcast:', currentBroadcastId);
                socket.emit('broadcastMessage', {
                    broadcastId: currentBroadcastId,
                    message: message,
                    sender: 'ƒ∞zleyici'
                });
                messageInput.value = '';
                
                // Add message to chat immediately
                addChatMessage('ƒ∞zleyici', message, new Date().toISOString());
            } else if (!currentBroadcastId) {
                alert('√ñnce bir yayƒ±na katƒ±lƒ±n!');
            }
        }

        // Add chat message
        function addChatMessage(sender, message, timestamp) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            messageDiv.innerHTML = `
                <span class="sender">${sender}:</span>
                <span class="time">${new Date(timestamp).toLocaleTimeString('tr-TR')}</span>
                <div style="margin-top: 5px;">${message}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Enter key for chat
        document.getElementById('chatMessage').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Auto-refresh broadcasts every 30 seconds
        setInterval(loadBroadcasts, 30000);
        
        // Load broadcasts immediately on page load
        window.addEventListener('load', () => {
            console.log('Page loaded, loading broadcasts...');
            loadBroadcasts();
            
            // Check for broadcast ID in URL
            const urlParams = new URLSearchParams(window.location.search);
            const broadcastId = urlParams.get('broadcast');
            if (broadcastId) {
                console.log('Auto-joining broadcast:', broadcastId);
                // Wait for broadcasts to load, then auto-join
                setTimeout(() => {
                    const broadcast = broadcasts.find(b => b.id == broadcastId);
                    if (broadcast) {
                        joinBroadcast(broadcast);
                    }
                }, 1000);
            }
        });
    </script>
</body>
</html>
